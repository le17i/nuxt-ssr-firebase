version: 2
jobs:
  build:
    working_directory: ~/nuxt-ssr-firebase
    docker:
      - image: circleci/node:8.11.2
    steps:
      - checkout
      - run:
        name: Install firebase tools
        command: yarn global add firebase-tools
      - run:
        name: Install deps from Nuxt project
        command: cd src && yarn install
      - run:
        name: Install deps from Firebase Functions project
        command: cd functions && yarn install
      - run:
        name: Build Nuxt project
        command: cd src && yarn build
      - run:
        name: Create public folder to static files
        command: mkdir public
      - run:
        name: Copy files from nuxt folder to public folder
        command: cp -R functions/nuxt/dist/ public
      - run:
        name: Deploy on firebase
        command: firebase deploy --token=$FIREBASE_TOKEN
